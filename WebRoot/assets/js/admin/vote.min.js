function Option(a,b){this.uuid=a,this.option=b}function Subject(a,b,c,d){this.uuid=a,this.title=b,this.type=c,this.options=d}function disableEdit(){var a=$("#vote_container");a.find("input").attr("readonly",!0),a.find("button").remove(),a.find(".vote-del").remove(),a.find(".option-del-btn").remove(),a.find(".option-add-btn").remove(),$("#edit_forbidden_tips").show()}$(document).ready(function(){function e(c){var d=$('<li data-id="'+c.uuid+'" class="list-group-item"></li>'),e=a.clone();d.append(e),b.append(d),e.find(".vote-title").val(c.title);var h=d.find(".vote-options-container");0==c.options.length?g(h,empty_option):$.each(c.options,function(a,b){g(h,new Option(b.uuid,b.option))}),f(d),d.find(".save-vote-btn").click(function(){i(d)});var j=d.find(".vote-type");j.val(c.type),c.uuid.trim()&&j.attr("disabled","disabled")}function f(a){a.find(".vote-del").click(function(){var b=confirm("\u5220\u9664\u4e4b\u540e\u5c06\u4e0d\u53ef\u6062\u590d");if(b){var c=a.data("id");c.trim()?$.post("/project/resource/vote/del",{uuid:c},function(){}).always(function(b){"success"==b.status?a.remove():alert(b.status)}):a.remove()}})}function g(a,b){var c=$('<div data-id="'+b.uuid+'" class="form-group option-item-container"><label class="col-sm-2 control-label"></label><div class="col-sm-4"><input type="text" value="'+b.option+'" class="form-control"  placeholder="\u8bf7\u8f93\u5165\u6295\u7968\u9009\u9879"></div></div>'),d=$('<a style="margin-right: 10px;" class="option-del-btn">\u5220\u9664</a>'),e=$('<a class="option-add-btn">\u589e\u52a0</a>');e.click(function(b){b.preventDefault(),g(a,empty_option)}),d.click(function(d){if(d.preventDefault(),!b.uuid.trim())return void h(a,c);var e=confirm("\u786e\u8ba4\u5220\u9664\uff1f");e&&$.post("/project/resource/vote/option/del",{uuid:b.uuid},function(){}).always(function(b){"success"==b.status?h(a,c):b.message&&alert(b.message)})}),a.find(".option-add-btn").hide(),c.append(d),c.append(e),a.append(c);var f=a.find(".option-del-btn");1==f.length?f.hide():f.show()}function h(a,b){b.remove(),a.find(".option-add-btn").last().show();var c=a.find(".option-del-btn");1==c.length&&c.hide()}function i(a){var b=[],d=a.find(".vote-title").val(),e=a.find(".vote-type").val(),f=a.data("id"),g=!1;a.find(".option-item-container").each(function(a,c){var d=$(c),e=d.find("input[type=text]").val();e.trim()||(g=!0);var f=d.data("id");b.push({uuid:f,option:e})});var h={uuid:f,title:d,type:parseInt(e),options:b};if(!d.trim())return void alert("\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a");if(g)return void alert("\u9009\u9879\u503c\u4e0d\u80fd\u4e3a\u7a7a");if(!f.trim()){var i=confirm("\u63d0\u4ea4\u4e4b\u540e\uff0c\u9898\u578b\u5c06\u4e0d\u53ef\u66f4\u6539!");if(!i)return}$.post("/project/resource/vote/save",{res_uuid:c,vote_data:JSON.stringify(h)},function(){}).always(function(b){"success"==b.status?(j(a,b),alert("\u4fdd\u5b58\u6210\u529f")):b.message?alert(b.message):alert(b.status)})}function j(a,b){a.find(".vote-title").val(b.title);var c=a.find(".vote-type");c.val(b.type),b.uuid.trim()&&c.attr("disabled","disabled"),a.data("id",b.uuid),a.find(".option-item-container").remove();var d=a.find(".vote-options-container");$.each(b.options,function(a,b){g(d,b)})}showActive(["video_mrg_nav","assets-mgr"]);var a=$("#vote_seed").find(".vote-item-clean"),b=$("#vote_container .list-group"),c=$("#res_uuid").val();$("#votes_data").val();$("#new_vote_controller").click(function(){e(empty_subject)}),votes.length>0&&$.each(votes,function(a,b){e(new Subject(b.uuid,b.title,b.type,b.options))}),editable||disableEdit()});var empty_subject=new Subject("","",1,[]),empty_option=new Option("","");