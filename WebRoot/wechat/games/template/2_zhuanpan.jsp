<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<meta name="wxc-sitekey" content="a8643">
<meta name="wxc-baseurl" content="http://v.wedocrm.cn/ap/">
<meta name="wxc-usertoken" content="010-01540bb1bca64d1e">
<meta name="wxc-userappid" content="wx46e60f0e8ed323a0">
<meta name="wxc-userapptype" content="1">
<meta name="wxc-componentappid" content="wx95c7ff09332c8789">
<meta name="wxc-ext-generateVer" content="xPortal_2.1">
<meta name="wxc-ext-generateTime" content="20160422162358">
<title>test</title>
<meta name="description" content="">
<link
	href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css"
	type="text/css" rel="stylesheet">
<link
	href="http://cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"
	type="text/css" rel="stylesheet">
<link href="http://img1.qidapp.cn/wxcrm/wdui/wdui.css?v=0.4"
	type="text/css" rel="stylesheet">
<style type="text/css">
body {
	padding: 0;
	background: #2c8c04
		url(http://img1.qidapp.cn/wxcrm/site/activity/roundabout/bg2.jpg)
		repeat center center;
}

#roundabout {
	margin: 0;
	text-align: center;
}

.r-panel {
	background:
		url(http://img1.qidapp.cn/wxcrm/site/activity/roundabout/round_panel.png)
		no-repeat center center;
	position: relative;
	margin: 12px auto;
	overflow: hidden;
}

.r-panel .dots {
	background:
		url(http://img1.qidapp.cn/wxcrm/site/activity/roundabout/round_dot.png)
		no-repeat center center;
}

.r-panel .point-panel {
	background:
		url(http://img1.qidapp.cn/wxcrm/site/activity/roundabout/point_panel.png)
		no-repeat center center;
}

.r-panel .point-arrow {
	background:
		url(http://img1.qidapp.cn/wxcrm/site/activity/roundabout/point_arrow.png)
		no-repeat center center;
}

.r-panel .point-cdot {
	background:
		url(http://img1.qidapp.cn/wxcrm/site/activity/roundabout/point_cdot.png)
		no-repeat center center;
}

.r-panel .point-btn {
	background:
		url(http://img1.qidapp.cn/wxcrm/site/activity/roundabout/point_btn.png)
		no-repeat center center;
}

.r-panel, .r-panel>div {
	width: 320px;
	height: 320px;
	background-size: 320px !important;
}

.r-panel>div {
	position: absolute;
	left: 50%;
	top: 50%;
	margin-left: -160px;
	margin-top: -160px;
}

.r-panel div.point-btn {
	width: 80px;
	height: 80px;
	margin-left: -40px;
	margin-top: -40px;
	cursor: pointer;
}

.info-box {
	background-color: #fef8b2;
	box-shadow: 0 0 6px rgba(0, 0, 0, 0.5);
	margin: 14px;
	margin-bottom: 18px;
	border-radius: 5px;
}

.info-box .info-box-inner {
	border: 1px dashed #ccc;
	border-radius: 5px;
}

.info-box-inner h4 {
	background:
		url(http://img1.qidapp.cn/wxcrm/site/activity/roundabout/bg-title.png)
		no-repeat 0 0;
	margin: 0;
	height: 22px;
	line-height: 22px;
	font-size: 16px;
	padding-left: 9px;
	color: #fff;
	border-top-left-radius: 4px;
}

.info-box-inner>div {
	padding: 12px 15px;
	color: #3d90f0;
	line-height: 1.4;
	font-size: 14px;
}

.lucky {
	position: relative;
}

.lucky span {
	position: absolute;
	font-size: 17px;
	font-family: '黑体';
	width: 20px;
	height: 70px;
	text-align: center;
	line-height: 1.1;
	color: #fff;
	text-shadow: 1px 1px 1px #f80;
	display: none;
}

.lucky span.z1 {
	padding-top: 20px;
	font-size: 22px;
}

.lucky span.z2 {
	padding-top: 13px;
	font-size: 19px;
}

.lucky span.z3 {
	padding-top: 5px;
}

.lucky span.z4 {
	font-size: 15.5px;
	padding-top: 3px;
}

.lucky span.z5 {
	padding-top: 0px;
	font-size: 13px;
	line-height: 1;
}

.lucky span.nol {
	color: #f9f9f9;
	line-height: 1.06;
	font-size: 14px;
	padding-top: 4px;
}

.lucky span.item1 {
	top: 44px;
	left: 128px;
}

.lucky span.item2 {
	top: 44px;
	left: 171px;
}

.lucky span.item3 {
	top: 64px;
	right: 91px;
}

.lucky span.item4 {
	top: 103px;
	right: 71px;
}

.lucky span.item5 {
	top: 146px;
	right: 71px;
}

.lucky span.item6 {
	bottom: 66px;
	right: 91px;
}

.lucky span.item7 {
	bottom: 47px;
	right: 129px;
}

.lucky span.item8 {
	bottom: 47px;
	left: 129px;
}

.lucky span.item9 {
	bottom: 66px;
	left: 91px;
}

.lucky span.item10 {
	bottom: 104px;
	left: 71px;
}

.lucky span.item11 {
	bottom: 147px;
	left: 71px;
}

.lucky span.item12 {
	top: 64px;
	left: 91px;
}
</style>
</head>
<body class="wdui">
	<div id="sharePicUrl">
		<img src="http://img1.qidapp.cn/wxcrm/img/picurl-roundabout.png">
	</div>
	<div class="bd">
		<div id="roundabout">
			<div class="r-panel">
				<div class="dots"></div>
				<div data-count="3" class="lucky">
					<span data-level="1">一等奖</span> <span data-level="2">二等奖</span> <span
						data-level="3">三等奖</span>
				</div>
				<div class="point-panel"></div>
				<div class="point-arrow"></div>
				<div class="point-cdot"></div>
				<div class="point-btn"></div>
			</div>
		</div>
		<div class="info-box">
			<div class="info-box-inner">
				<h4>奖项设置</h4>
				<div>
					<ul style="padding-left: 16px; margin-bottom: 0;" class="-detail">
						<li data-level="1">一等奖：a</li>
						<li data-level="2">二等奖：b</li>
						<li data-level="3">三等奖：c</li>
					</ul>
				</div>
			</div>
		</div>
		<div class="info-box">
			<div class="info-box-inner">
				<h4>活动说明</h4>
				<div>test</div>
			</div>
		</div>
	</div>
	<style type="text/css">
.tipsbox {
	text-align: center;
	position: absolute;
	left: 0;
	right: 0;
	top: 0;
	z-index: 1999;
}

.tipsbox h1 {
	font-size: 26px;
	color: #f9b100;
	margin-top: 200px;
	margin-bottom: 6px;
	font-weight: bold;
	z-index: 1999;
}

.tipsbox h2 {
	color: #fff;
	font-size: 18px;
	padding: 0 8%;
	line-height: 1.5;
	z-index: 1999;
	margin-top: 0
}

.tipsbox p {
	color: #fff;
	font-size: 13px;
	margin: 9px 8%;
}

.tipsbox.luck {
	background: url(http://img1.qidapp.cn/wxcrm/site/activity/cupbg.png)
		no-repeat center -180px;
	background-size: 280px auto;
}

.btn-wrap {
	margin: 0;
	margin-top: 30px;
	text-align: center;
}

.btn-wrap .btn.wdui-btn {
	width: 84%;
	border: 0;
	font-size: 15px;
}

.btn-wrap.col2 .btn.wdui-btn {
	width: 41%;
	margin: 0 1%;
}

.btn-wrap.col2 .btn.wdui-btn:first-chile {
	margin-left: 0;
}

.btn-wrap.col2 .btn.wdui-btn:last-chile {
	margin-right: 0;
}

.input-wrap {
	margin-bottom: -15px;
}

.input-wrap input {
	width: 84%;
	border: 0 none;
	border-radius: 0;
	padding: 4px 6px;
	border-bottom: 1px solid #fff;
	margin-bottom: 6px;
	background-color: transparent;
	color: #fff;
	font-size: 15px;
	text-align: center;
}

#lucky_tip_box, #nolucky_tip_box {
	display: none
}

#nolucky_tip_box h1 {
	font-size: 21px;
	margin-top: 30%;
	margin-bottom: 18px;
}

#nolucky_tip_box h2 {
	font-size: 15px;
	margin: 0;
}

.copyright {
	background-color: rgba(0, 0, 0, 0.2);
	color: #fff !important;
	padding: 7px;
}

.wdui-share-tips {
	z-index: 1999
}
</style>
	<div id="lucky_tip_box">
		<div class="modal-backdrop"></div>
		<div class="tipsbox luck">
			<h1>中奖啦</h1>
			<h2></h2>
			<div class="input-wrap">
				<input type="text" id="name" placeholder="请输入姓名"> <input
					type="tel" id="phone" placeholder="请输入手机号码" maxlength="11">
				<p></p>
			</div>
			<div class="btn-wrap col2">
				<a class="btn btn-default wdui-btn">提交兑奖信息</a> <a
					class="btn btn-success wdui-btn">告诉小伙伴</a>
			</div>
		</div>
	</div>
	<div id="nolucky_tip_box">
		<div class="modal-backdrop"></div>
		<div class="tipsbox">
			<h1>很遗憾你没有中奖</h1>
			<h2></h2>
			<div class="btn-wrap col2">
				<a class="btn btn-default wdui-btn">再来一次</a> <a
					class="btn btn-success wdui-btn">告诉小伙伴</a>
			</div>
		</div>
	</div>
	<div class="copyright" >&copy;xx支持</div>
	<script src="http://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"
		type="text/javascript"></script>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"
		type="text/javascript"></script>
	<script src="http://img1.qidapp.cn/wxcrm/wdui/wdui-1.1.js?v=0.8"
		type="text/javascript"></script>
	<script src="http://img1.qidapp.cn/wxcrm/site/kf/kf-dialog.M150929.js"
		type="text/javascript"></script>
	<script type="text/javascript">
</script>
	<script src="http://img1.qidapp.cn/wxcrm/site/activity/jQueryRotate.js"
		type="text/javascript"></script>
	<script
		src="http://img1.qidapp.cn/wxcrm/site/activity/common-activity.M160109.js"
		type="text/javascript"></script>
	<script type="text/javascript">
var _ACTIVITY_ID = '150-01540bb9a3d44d64';
var dot_round = 0, dot_timer;
var point_round = 0;
var hit_level, giftName;
var token;
$(document).ready(function(){
	if ($wdui.check_openid(true) == 9999) return;
	if (!openid){ location.href = baseurl + 's/noopenid.dx?ref=' + $e(location.href) + '&usertoken=' + usertoken; return; }
	
	var lucky_span = $('.lucky span');
	var lucky_p = LUCKY_POS[lucky_span.length];
	lucky_span.each(function(idx, item){
		item = $(item);
		item.addClass('item' + lucky_p[idx] + ' z' + item.text().length);
		item.rotate(LUCKY_ROTATE[lucky_p[idx]]);
	});
	var NOL_TXTs = ['再接再厉', '不要灰心', '没有抽中', '谢谢参与', '祝你好运', '不要灰心', '攒攒人气'];
	for (var i = 1; i <= 12; i++){
		if ($('.lucky .item' + i).length == 0){
			var item = $('<span class="item' + i + ' nol z4">' + NOL_TXTs[i > 6 ? 12 - i : i] + '</span>').appendTo('.lucky');
			item.rotate(LUCKY_ROTATE[i]);
		}
	}
	$('.lucky span').show();
	
	activity_check(function(){
		$('.point-btn').click(function(){
			clearInterval(dot_timer);
			$(this).hide(400);
			setTimeout(function(){
				var rnd = 12 * ~~(Math.random() * 5);
				rnd = 12 * 3;
				run_lucky(1, rnd + 1);
			}, 400);
			$.getJSON((window.ACT_2HURL||baseurl) + 'plugins/activity/gift_get.dx?jsoncallback=?&id=150-01540bb9a3d44d64', REQ_CTX, function(result){
				var data = result.data;
				luckyman_id = data.id;
				hit_level = ~~data.level;
				giftName = data.giftName;
				token = data.token;
			});
		});
	});
	
	dot_timer = setInterval(function(){
		dot_round = dot_round == 0 ? 15 : 0;
		$('.dots').rotate(dot_round);
	}, 800);
});
var max_speed = 7;
var run_lucky = function(times, hit){
	if (times == hit){
		var arrow_rule = POINT_LEVEL[$('.lucky').data('count')];
		var arrow_angle = 0;
		if (hit_level <= 0){
			while (true){
				arrow_angle = ~~(Math.random() * 12);
				if ($.inArray(arrow_angle * 30, arrow_rule) == -1) break;
			}
		} else{
			arrow_angle = arrow_rule[hit_level - 1];
			arrow_angle = arrow_angle / 30;
		}
		
		setTimeout(function(){
			stop_lucky(arrow_angle);
		}, 100);
		return;
	}
	
	run_step(times);
	setTimeout(function(){
		run_lucky(times + 1, hit);
	}, 320 - (times > 10 ? max_speed : times) * 30);
};
var stop_lucky = function(times){
	if (times <= 0){
		var gift = $('.lucky .item' + hit_level).text();
		if (!!gift){
			dot_timer = setInterval(function(){
				dot_round = dot_round == 0 ? 15 : 0;
				$('.dots').rotate(dot_round);
			}, 50);
			$.getJSON((window.ACT_2HURL||baseurl) + 'plugins/activity/lottery_record.dx?jsoncallback=?&id=150-01540bb9a3d44d64&level=' + hit_level + '&giftName=' + giftName + '&token=' + token, REQ_CTX, function(data){
				if (~~data.status == 0) {
					$wdui.msg_tips(data.data);
					return;
				} else {
					luckyman_id = data.data;
					luck_tip(hit_level);
				}
			});
		}else{
			no_luck_tip('很遗憾你没有中奖', true);
			$.getJSON((window.ACT_2HURL||baseurl) + 'plugins/activity/lottery_record.dx?jsoncallback=?&id=150-01540bb9a3d44d64', REQ_CTX);
		}
		return;
	}
	
	run_step(times);
	setTimeout(function(){
		stop_lucky(times - 1);
	}, 360 - times * 30);
};
var run_step = function(times){
	if (times % 3 == 0){
		dot_round = dot_round == 15 ? 0 : 15;
		setTimeout(function(){
			$('.dots').rotate(dot_round);
		}, 15);
	}
	point_round += 30;
	if (point_round >= 360) point_round = 0;
	$('.point-arrow').rotate(point_round);
};
var POINT_LEVEL = {3: [30, 150, 270], 4: [30, 90, 210, 270], 5:[30, 90, 150, 210, 270], 6:[30, 90, 150, 210, 270, 330], 7:[30, 90, 150, 210, 270, 330, 0], 8:[30, 90, 150, 210, 270, 330, 0, 180],9:[30, 90, 150, 210, 270, 330, 0, 180, 120]};
var LUCKY_POS = {3:[1,5,9], 4:[1,3,7,9], 5:[1,3,5,7,9], 6:[1,3,5,7,9,11], 7:[1,3,5,7,9,11,12], 8:[1,3,5,7,9,11,12,6], 9:[1,3,5,7,9,11,12,6,4]};
var LUCKY_ROTATE = {1:-15, 2:14, 3:45, 4:75, 5:103, 6:134, 7:167, 8:197, 9:224, 10:255, 11:283, 12:316};
</script>
</body>
</html>